## New Features

### Manual Migration System

Added a complete file-based migration system with journal tracking for production-grade database schema management.

#### MigrationRunner

Execute migrations with transaction safety:

```typescript
import { MigrationRunner, PgClient } from 'linkgress-orm';
import { AppDatabase } from './database';

const client = new PgClient({ /* config */ });
const db = new AppDatabase(client);

const runner = new MigrationRunner(db, {
  migrationsDirectory: './migrations',
  journalTable: '__migrations',  // default
  verbose: true,
});

// Run all pending migrations
const result = await runner.up();

// Revert last N migrations
await runner.down(1);

// Check status
const status = await runner.status();
```

**Key Methods:**
- `up()` - Run all pending migrations in order
- `down(count)` - Revert the last N migrations
- `getPending()` - Get list of pending migration filenames
- `getApplied()` - Get list of applied migration filenames
- `status()` - Get detailed status of all migrations

#### MigrationScaffold

Generate migration files from schema differences:

```typescript
import { MigrationScaffold } from 'linkgress-orm';

const scaffold = new MigrationScaffold(db, {
  migrationsDirectory: './migrations',
});

// Generate migration from schema diff
const result = await scaffold.scaffold('../src/database');
console.log(`Created: ${result.filename} with ${result.operations} operations`);

// Generate empty migration template
const empty = await scaffold.scaffoldEmpty();
```

The scaffold compares your database schema to your `DbContext` model and generates SQL for:
- Creating/dropping schemas, ENUM types, sequences
- Creating/dropping tables
- Adding/dropping/altering columns
- Creating/dropping indexes and foreign keys

#### MigrationLoader

Dynamic TypeScript file loading:
- Loads any `.ts` file from the migrations directory
- Files sorted lexicographically for proper execution order
- Works with ts-node, tsx, and other TypeScript loaders
- Recommended naming: `YYYYMMDD-HHMMSS.ts` (but any name accepted)

#### MigrationJournal

Track applied migrations in a database table:
- Automatic journal table creation (`__migrations`)
- Configurable table name and schema
- Records migration filename and applied timestamp

#### Migration File Format

```typescript
// migrations/20250204-143052.ts
import type { Migration } from 'linkgress-orm';
import type { AppDatabase } from '../src/database';

export default class implements Migration {
  async up(db: AppDatabase): Promise<void> {
    await db.query(`ALTER TABLE "users" ADD COLUMN "phone" VARCHAR(20)`);
  }

  async down(db: AppDatabase): Promise<void> {
    await db.query(`ALTER TABLE "users" DROP COLUMN "phone"`);
  }
}
```

### DbContext.getClient()

New public method to access the underlying database client for advanced operations.

---

### Technical Details

#### Transaction Safety
Each migration runs inside a database transaction. If a migration fails, it is automatically rolled back, and subsequent migrations are not executed.

#### Database Client Compatibility
Generated migrations use `db.query()` which works with all database clients (PgClient, PostgresClient, BunClient).

### Files Added

- `src/migration/migration.interface.ts` - Core types and interfaces
- `src/migration/migration-journal.ts` - Journal table management
- `src/migration/migration-loader.ts` - Dynamic TS file loading
- `src/migration/migration-runner.ts` - Migration execution
- `src/migration/migration-scaffold.ts` - Migration file generation

### Files Changed

- `src/migration/db-schema-manager.ts` - Exported `MigrationOperation` type
- `src/entity/db-context.ts` - Added `getClient()` method
- `src/index.ts` - Added exports for migration system

### New Exports

```typescript
// Types
export type { Migration, MigrationConfig, MigrationJournalEntry, LoadedMigration, MigrationRunResult, MigrationDirection } from './migration/migration.interface';
export type { MigrationOperation } from './migration/db-schema-manager';

// Classes
export { MigrationRunner } from './migration/migration-runner';
export { MigrationJournal } from './migration/migration-journal';
export { MigrationLoader } from './migration/migration-loader';
export { MigrationScaffold } from './migration/migration-scaffold';
```
